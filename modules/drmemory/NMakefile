CC = cl
CFLAGS = /nologo /W4 /EHsc /Za
XML_PATH=C:\licenta\robocheck\lib-win

FILES = rbc_drmemory.c
FILES_OBJ = rbc_drmemory.obj
LIB_LIST = libxml2.lib libxslt.lib iconv.lib


all: utils compile
	link /nologo /dll /out:libdrmemory.dll /implib:libdrmemory.lib $(FILES_OBJ) libutils.lib

utils: utils.obj
	link /nologo /dll /out:libutils.dll /implib:libutils.lib utils.obj

utils.obj:
	$(CC) $(CFLAGS) /DDLL_EXPORTS /I$(XML_PATH) /c /Fo$@ ../../src/utils.c
	
compile: $(FILES_OBJ)

rbc_drmemory.obj:
	$(CC) $(CFLAGS) /I$(XML_PATH) /c /Fo$@ $(FILES)
	
clean:
	del $(FILES_OBJ) utils.obj libutils.dll libutils.lib